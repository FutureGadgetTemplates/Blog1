{% assign maxRelated = 3 %}
{% assign minCommonTags = 1 %}
{% assign maxRelatedCounter = 0 %}

{% assign related_posts = "" | split: "" %}

{% for post in site.posts %}
  {% if post.url != page.url %}
    {% assign sameTagCount = 0 %}
    {% for tag in post.tags %}
      {% if page.tags contains tag %}
        {% assign sameTagCount = sameTagCount | plus: 1 %}
      {% endif %}
    {% endfor %}
    {% for category in post.categories %}
      {% if page.categories contains category %}
        {% assign sameTagCount = sameTagCount | plus: 1 %}
      {% endif %}
    {% endfor %}
    {% if sameTagCount >= minCommonTags %}
      {% assign related_posts = related_posts | push: post %}
      {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
      {% if maxRelatedCounter >= maxRelated %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if related_posts.size > 0 %}
<section class="related-posts">
  <div class="container">
    <h2 class="section-title">Related Posts</h2>
    <div class="posts-grid posts-grid-3">
      {% for post in related_posts %}
      {% include post-card.html post=post %}
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}
